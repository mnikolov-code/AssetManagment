<!DOCTYPE html>
<html lang="mk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset List</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
        }
        .container {
            margin: 50px auto;
			text-align: center;
            padding: 20px;
            width: 40%;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #323481;
            color: white;
        }
        td {
            background-color: #F2F0DF;
        }
        .button {
            padding: 8px 12px;
            border: none;
            cursor: pointer;
            margin: 5px;
        }
        .history-btn {
            background-color: #007bff;
            color: white;
        }
        .edit-btn {
            background-color: #28a745;
            color: white;
        }
        .print-btn {
            background-color: #ff9800;
            color: white;
        }
        .modal {
    display: none; 
    position: fixed; 
    top: 50%; 
    left: 50%; 
    transform: translate(-50%, -50%); 
    background-color: white;
    padding: 20px;
    border: 2px solid #888;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    z-index: 9999; 
    width: 50%;
    max-width: 600px;
    text-align: left; 
	  max-height: 80%; 
    overflow-y: auto; 
}

.close-btn {
    font-size: 24px;
    cursor: pointer;
    color: red;
    position: absolute;
    top: 10px;
    right: 10px;
}

        }
        h2 {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
        }

        .record {
            padding: 10px;
            background-color: #F2F0DF;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .record-container {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #loginModal {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 85%;
    background: #f2f1ef;
    position: fixed;
    top: 50%;
    left: 50%;
    width: 50%;
    z-index: 999;
    background-image: url('https://1.bp.blogspot.com/-MyRKRDqfQ9k/Ur7pA019jhI/AAAAAAAAABY/7IfGY-nIYxk/s1600/20121711-alkaloid.jpg');
    background-position: top right;
    background-repeat: no-repeat;
    background-size: 100px; 
}


        #loginModal div {
            background: #f2f1ef;
            padding: 1px;
            border-radius: 10000px;
            text-align: center;
            min-width: 100px;
            box-shadow: #0c2c68;
        }
		
		@keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0; }
    100% { opacity: 1; }
}

#logo {
    position: fixed; 
    top: 10px; 
    left: 10px; 
    width: 100px; 
    height: auto; 
    z-index: 1000; 
}


h1 {
    color: #0c2c68;
}

.logout-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background-color: #dc3545;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
}

.logout-btn:hover {
    background-color: #b02a37;
}

#adminModal {
    display: none;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    width: 50%; /* –ü–æ—Å—Ç–∞–≤–∏ –ø–æ–º–∞–ª–∞ —à–∏—Ä–∏–Ω–∞ */
    text-align: center;
	height: 50%;
}

#adminModal input {
    width: 80%; /* –ù–∞–º–∞–ª–µ–Ω–∞ —à–∏—Ä–∏–Ω–∞ –Ω–∞ –ø–æ–ª–µ—Ç–æ –∑–∞ –ª–æ–∑–∏–Ω–∫–∞ */
    padding: 8px;
    margin-top: 10px;
    font-size: 14px;
    text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–∞—ò –≥–æ —Ç–µ–∫—Å—Ç–æ—Ç –≤–æ –ø–æ–ª–µ—Ç–æ */
}

#adminModal button {
    width: 50%; /* –ù–∞–º–∞–ª–∏ –≥–æ –∫–æ–ø—á–µ—Ç–æ */
    padding: 8px;
    margin-top: 10px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

#adminModal button:hover {
    background-color: #0056b3;
}


#logsTable {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

#logsTable th, #logsTable td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: left;
}

#logsTable th {
    background-color: #323481;
    color: white;
}

.exit-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background-color: #dc3545;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
}

.exit-btn:hover {
    background-color: #b02a37;
}

.export-btn {
    background-color: #28a745;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 10px;
}

.export-btn:hover {
    background-color: #218838;
}

#dateFilterContainer {
    display: flex;
    justify-content: flex-end; 
    align-items: center;
    gap: 10px; 
    margin-bottom: 10px;
    width: 100%; 
}

#searchQuery {
    width: 50%; 
    max-width: 40%; 
    padding: 10px; 
    border-radius: 10px;
}


#detailsModal {
    display: none; /* –°–∫—Ä–∏—ò –≥–æ –ø–æ —É–º–æ–ª—á—É–≤–∞—ö–µ */
    position: fixed;
    z-index: 1000;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%); /* –¶–µ–Ω—Ç—Ä–∏—Ä–∞—ò –≥–æ –ø–æ–ø-–∞–ø –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç */
    width: 60%; /* –ì–æ–ª–µ–º–∏–Ω–∞ –Ω–∞ –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç */
    max-width: 700px; /* –û–≥—Ä–∞–Ω–∏—á—É–≤–∞—ö–µ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª–Ω–∞—Ç–∞ —à–∏—Ä–∏–Ω–∞ */
    background-color: white;
    padding: 20px;
    border: 2px solid #888;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    text-align: left; /* –ó–∞ –¥–∞ —Ç–µ–∫—Å—Ç–æ—Ç –±–∏–¥–µ –ª–µ–≤–æ –ø–æ—Ä–∞–≤–Ω–∞—Ç */
    overflow-y: auto; /* –ó–∞ –¥–∞ –º–æ–∂–µ—à –¥–∞ —Å–∫—Ä–æ–ª–∞—à –∞–∫–æ –∏–º–∞ –º–Ω–æ–≥—É —Ç–µ–∫—Å—Ç */
}

/* –°—Ç–∏–ª –∑–∞ –∫–æ–ø—á–µ—Ç–æ –∑–∞ –∑–∞—Ç–≤–æ—Ä–∞—ö–µ */
#detailsModal .close-btn {
    font-size: 24px;
    color: red;
    cursor: pointer;
    position: absolute;
    top: 10px;
    right: 10px;
}

.popup {
    display: none;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    border: 1px solid #ccc;
    box-shadow: 0px 0px 10px gray;
    z-index: 1000;
}

.popup-content {
    text-align: center;
}


.suggestions {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    max-height: 150px;
    overflow-y: auto;
    display: none;
    width: 200px;
}

.suggestions div {
    padding: 5px;
    cursor: pointer;
}

.suggestions div:hover {
    background: #ddd;
}

.suggestions {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    max-height: 150px;
    overflow-y: auto;
    display: none;
    width: 200px;
    z-index: 1000;
}

.suggestions div {
    padding: 5px;
    cursor: pointer;
}

.suggestions div:hover {
    background: #ddd;
}

#selectedFilesContainer {
    margin-top: 10px;
    padding: 10px;
    border: 1px solid #ccc;
    background: white;
    max-width: 400px;
    min-height: 40px;
}

.selected-file {
    display: flex;
    align-items: center;
    padding: 5px;
    background: #f2f2f2;
    margin: 5px;
    border-radius: 5px;
}

.selected-file button {
    background: red;
    color: white;
    border: none;
    cursor: pointer;
    margin-left: 10px;
    padding: 2px 6px;
}
.search-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    width: 100%;
    margin-top: 20px;
}

h1 {
    margin-bottom: 20px;
}

/* –ü—Ä–≤ —Ä–µ–¥ - –ü—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (–ª–µ–≤–æ) –∏ –ª–∏—Å—Ç–∞ –Ω–∞ –∏–∑–±—Ä–∞–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (–¥–µ—Å–Ω–æ) */
.search-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 80%;
    max-width: 800px;
}

.left {
    flex: 1;
    text-align: left;
}

.right {
    flex: 1;
    text-align: right;
}

/* –ù–∞–º–∞–ª–µ–Ω–æ –ø–æ–ª–µ –∑–∞ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ */
#typeSearch {
    width: 250px;
    padding: 8px;
    border-radius: 10px;
    text-align: left;
}

/* –ö—É—Ç–∏—ò–∞ –∑–∞ –∏–∑–±—Ä–∞–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ (–¥–µ—Å–Ω–æ) */
#selectedFilesContainer {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 300px;
    max-width: 350px;
    background: white;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
}


.search-bar {
    display: flex;
    justify-content: center;
    width: 100%;
    margin-top: 20px;
}

.search-button-container {
    display: flex;
    justify-content: center;
    margin-top: 10px;
}

.search-button-container .button {
    width: 120%;
    max-width: 900px; 
    padding: 12px; 
    font-size: 16px; 
}


#searchQuery {
    width: 300px;
    padding: 10px;
    border-radius: 10px;
    text-align: center;
}



.selected-file {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 5px;
    background: #f2f2f2;
    margin: 5px 0;
    border-radius: 5px;
}



    </style>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
	
	<!-- Bootstrap 5 CDN -->
	<link rel="icon" href="/favicon.ico" type="image/x-icon">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	
</head>

<body onload="checkLogin()">

<img id="logo" src="https://1.bp.blogspot.com/-MyRKRDqfQ9k/Ur7pA019jhI/AAAAAAAAABY/7IfGY-nIYxk/s1600/20121711-alkaloid.jpg" 
     alt="Company Logo" onclick="openAdminModal()">


<!-- üîí –ü–æ–ø-–∞–ø –∑–∞ –Ω–∞—ò–∞–≤–∞ -->
<div id="loginModal" class="modal">
    <div>
        <h2>–ù–∞—ò–∞–≤–∞ <BR> Asset Lists </h2>
        <input type="text" id="loginEmail" placeholder="–ï-–º–∞–∏–ª">
        <input type="password" id="loginPassword" placeholder="–õ–æ–∑–∏–Ω–∫–∞">
		<BR>
        <button onclick="confirmLogin()"><B>–ù–∞—ò–∞–≤–∏ —Å–µ</B></button>
        <p id="loginError" style="color: red; display: none;">–ù–µ–≤–∞–ª–∏–¥–µ–Ω –µ–º–∞–∏–ª –∏–ª–∏ –ª–æ–∑–∏–Ω–∫–∞!</p>
    </div>
</div>

<!-- –ì–ª–∞–≤–Ω–∞ —Å–æ–¥—Ä–∂–∏–Ω–∞ -->
<div id="mainContent" style="display: none;">

<div id="historyContainer" class="container" style="display: none; padding: 20px; margin-top: 20px;">
    <h2>–ò—Å—Ç–æ—Ä–∏—ò–∞ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏</h2>
    <div id="historyContent"></div>
</div>


<!-- –ü–æ–ø-–∞–ø –∑–∞ –ª–æ–∑–∏–Ω–∫–∞ -->
<div id="adminModal" class="modal">
    <div style="position: relative; padding: 20px;">
        <span class="close-btn" onclick="closeAdminModal()">&times;</span>
        <h2>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∞ –Ω–∞—ò–∞–≤–∞</h2>
        <input type="password" id="adminPassword" placeholder="–í–Ω–µ—Å–∏ –ª–æ–∑–∏–Ω–∫–∞">
        <button onclick="verifyAdminPassword()">–í–ª–µ–∑–∏</button>
        <p id="adminError" style="color: red; display: none;">–ù–µ—Ç–æ—á–Ω–∞ –ª–æ–∑–∏–Ω–∫–∞!</p>
    </div>
</div>
<button id="exportLogsBtn" class="button export-btn" onclick="exportToExcel()" style="display: none;">–ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞—ò</button>
<div id="dateFilterContainer" style="display: none; text-align: center; margin-bottom: 10px;">
    <label for="logDateFilter"><b>–ò–∑–±–µ—Ä–∏ –¥–∞—Ç—É–º:</b></label>
    <input type="date" id="logDateFilter" onchange="filterLogsByDate()">
</div>


<!-- –ü–æ–ø-–∞–ø –º–æ–¥–∞–ª –∑–∞ –∏—Å—Ç–æ—Ä–∏—ò–∞ -->
<div id="historyModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeHistoryModal()">&times;</span>
        <h2>–ò—Å—Ç–æ—Ä–∏—ò–∞ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏</h2>
        <div id="historyContent"></div>
        <button onclick="closeHistoryModal()">–û–ö</button>
    </div>
</div>


<!-- –î–∏–≤ –∑–∞ –ø—Ä–∏–∫–∞–∂—É–≤–∞—ö–µ –Ω–∞ –ª–æ–≥–æ–≤–∏—Ç–µ -->
<div id="logsContainer" class="container" style="display: none;">
<!-- –ö–æ–ø—á–µ –∑–∞ –∏–∑–ª–µ–∑ –æ–¥ Admin –ø–∞–Ω–µ–ª–æ—Ç -->
<button id="exitAdminBtn" class="button exit-btn" onclick="exitAdminPanel()">–ò–∑–ª–µ–∑–∏</button>

    <h2>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤–æ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ</h2>
    <table id="logsTable">
        <thead>
    <tr>
        <th onclick="sortTable()">–í—Ä–µ–º–µ ‚ñ≤</th>
        <th>–ö–æ—Ä–∏—Å–Ω–∏–∫</th>
        <th>–ê–∫—Ü–∏—ò–∞</th>
        <th>–î–µ—Ç–∞–ª–∏</th>
    </tr>
</thead>

        <tbody></tbody>
    </table>
</div>


<button id="logoutBtn" class="button logout-btn" onclick="logoutUser()">–û–¥—ò–∞–≤–∏ —Å–µ</button>


  <div class="search-container">
    <h1>–ü—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏</h1>
    
	
	   <div class="search-row">
        <div class="left">
            <input type="text" id="typeSearch" placeholder="–ü—Ä–µ–±–∞—Ä–∞—ò –¥–æ–∫—É–º–µ–Ω—Ç..." oninput="suggestFiles()">
            <div id="suggestionList" class="suggestions"></div>
        </div>
    <div class="right">
            <div id="selectedFilesContainer">
                <h6>üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∏ –∑–∞ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ:</h6>
                <div id="selectedFiles"></div>
            </div>
        </div>
    </div>
 <div class="search-bar">
    <input type="text" id="searchQuery" placeholder="–í–Ω–µ—Å–µ—Ç–µ –ø–æ–∏–º –∑–∞ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ...">
</div>

<div class="search-button-container">
    <button class="button history-btn" onclick="startSearch()">–ë–∞—Ä–∞—ò</button>
</div>

</div>
    <div id="results"></div>
    <div id="loadingMessage" style="display: none; font-weight: bold; color: red; animation: blink 1s infinite;">
        –ü—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ –≤–æ —Ç–µ–∫...
    </div>
</div>





<!-- –ü–æ–ø-–∞–ø –º–æ–¥–∞–ª –∑–∞ –¥–µ—Ç–∞–ª–∏ -->
<div id="detailsModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeDetailsModal()">&times;</span>
        <h2>–î–µ—Ç–∞–ª–∏</h2>
        <div id="detailsContent" style="text-align: left;">
            <!-- –§–æ—Ä–º–∞—Ç–∞ —ú–µ —Å–µ –ø–æ–ø–æ–ª–Ω–∏ –¥–∏–Ω–∞–º–∏—á–∫–∏ —Å–æ JavaScript -->
        </div>
        <button onclick="saveToPDF()">–ó–∞—á—É–≤–∞—ò –≤–æ PDF</button>
        
    </div>
</div>

</div>


<div id="detailsContainer" class="container" style="display: none;">

<!-- –ú–æ–¥–∞–ª –∑–∞ –≤–Ω–µ—Å—É–≤–∞—ö–µ –Ω–∞ –ø–∞—Å–≤–æ—Ä–¥ –ø—Ä–∏ —É—Ä–µ–¥—É–≤–∞—ö–µ -->
<div id="editModal" class="modal">
    <div style="position: relative; padding: 20px;">
        <span class="close-btn" onclick="closeEditModal()">&times;</span>
        <h2>–ù–∞—ò–∞–≤–∞ –∑–∞ —É—Ä–µ–¥—É–≤–∞—ö–µ</h2>
        <input type="text" id="email" placeholder="–ï-–º–∞–∏–ª">
        <input type="password" id="password" placeholder="–õ–æ–∑–∏–Ω–∫–∞">
        <button onclick="confirmLogin()">–ü–æ—Ç–≤—Ä–¥–∏</button>
        <p id="loginError" style="color: red; display: none;">–ù–µ–≤–∞–ª–∏–¥–µ–Ω –µ–º–∞–∏–ª –∏–ª–∏ –ª–æ–∑–∏–Ω–∫–∞!</p>
    </div>
</div>
 </div>
<script>
let selectedFiles = []; // üìå –õ–∏—Å—Ç–∞ –Ω–∞ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏

// –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –æ—Ç–≤–æ—Ä–∞—ö–µ –Ω–∞ –ø–æ–ø-–∞–ø –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç –∑–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∞ –Ω–∞—ò–∞–≤–∞
function openAdminModal() {
    document.getElementById("adminModal").style.display = "block";
}


async function saveSingleChange(fileName, rowIndex, columnName, newValue) {
    try {
        const response = await fetch('/edit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fileName, rowIndex, columnName, newValue, email: loggedInUser })
        });

        const result = await response.json();
        if (result.success) {
            alert('–ü—Ä–æ–º–µ–Ω–∞—Ç–∞ –µ —É—Å–ø–µ—à–Ω–æ –∑–∞—á—É–≤–∞–Ω–∞!');
        } else {
            console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ:", result.error);
            alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ');
        }
    } catch (error) {
        console.error('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ:', error);
        alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ');
    }
}


// Save the changes to the server
async function saveChanges(event) {
    event.preventDefault();  // –û–≤–¥–µ —Å–ø—Ä–µ—á—É–≤–∞–º–µ —Å—Ç–∞–Ω–¥–∞—Ä–¥–Ω–æ—Ç–æ –æ–¥–Ω–µ—Å—É–≤–∞—ö–µ

    // –ü—Ä–µ–∫—É getElementById –∏–ª–∏ –ø—Ä–µ–∫—É –∫–ª–∞—Å–∞—Ç–∞ –Ω–∞ –º–æ–¥–∞–ª–æ—Ç
    const detailsContent = document.getElementById('detailsContent');
    const inputs = detailsContent.querySelectorAll('input');

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —Å–µ –Ω–∞—ò–¥–µ–Ω–∏ input –µ–ª–µ–º–µ–Ω—Ç–∏
    if (!inputs.length) {
        alert("–ù–µ–º–∞ –≤–Ω–µ—Å–µ–Ω–∏ –ø–æ–¥–∞—Ç–æ—Ü–∏!");
        return;
    }

    const updatedData = {};
    inputs.forEach(input => {
        if (input.dataset.columnName) {  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –∏–º–∞ dataset –∞—Ç—Ä–∏–±—É—Ç
            updatedData[input.dataset.columnName] = input.value;
        }
    });

    const email = loggedInUser;

    try {
        const response = await fetch('/edit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ updatedData, email })  // –ò—Å–ø—Ä–∞—Ç–∏ –≥–∏ –Ω–æ–≤–∏—Ç–µ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∏ –∫–æ—Ä–∏—Å–Ω–∏—á–∫–∏–æ—Ç email
        });

        const result = await response.json();
        if (result.success) {
            alert('–ü—Ä–æ–º–µ–Ω–∏—Ç–µ —Å–µ –∑–∞—á—É–≤–∞–Ω–∏!');
            closeDetailsModal();  // –ó–∞—Ç–≤–æ—Ä–∏ –≥–æ –ø–æ–ø-–∞–ø–æ—Ç –∞–∫–æ –µ —É—Å–ø–µ—à–Ω–æ
        } else {
            alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ');
        }
    } catch (error) {
        console.error('–ì—Ä–µ—à–∫–∞:', error);
        alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ');
    }
}



async function showDetails(fileName) {
    const query = document.getElementById('searchQuery').value;

    try {
        const response = await fetch(`/details?fileName=${encodeURIComponent(fileName)}&query=${encodeURIComponent(query)}`);
        const report = await response.json();

        const detailsModal = document.getElementById('detailsModal');
        const detailsContent = document.getElementById('detailsContent');
        detailsContent.innerHTML = '';

        if (!report || report.data.length === 0) {
            detailsContent.innerHTML = '<p>–ù–µ–º–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∑–∞ –æ–≤–æ—ò –∑–∞–ø–∏—Å.</p>';
        } else {
            report.data.forEach((row, rowIndex) => {
                Object.keys(row).forEach((key) => {
                    const rowDiv = document.createElement('div');
                    rowDiv.style.marginBottom = '10px';

                    const label = document.createElement('label');
                    label.textContent = `${key}: `;
                    rowDiv.appendChild(label);

                    const input = document.createElement('input');
                    input.value = row[key];
                    input.dataset.columnName = key;
                    input.dataset.rowIndex = rowIndex;
                    rowDiv.appendChild(input);

                    // üìå –ö–æ–ø—á–µ –∑–∞ –∑–∞—á—É–≤—É–≤–∞—ö–µ
                    const saveBtn = document.createElement('button');
                    saveBtn.textContent = '–ó–∞—á—É–≤–∞—ò';
                    saveBtn.className = 'button edit-btn';
                    saveBtn.onclick = () => saveSingleChange(report.fileName, rowIndex, key, input.value);
                    rowDiv.appendChild(saveBtn);

                    // üìå –ö–æ–ø—á–µ –∑–∞ –∏—Å—Ç–æ—Ä–∏—ò–∞
                    const historyBtn = document.createElement('button');
                    historyBtn.textContent = '–ò—Å—Ç–æ—Ä–∏—ò–∞';
                    historyBtn.className = 'button history-btn';
                    historyBtn.onclick = () => showHistory(report.fileName, rowIndex, key);
                    rowDiv.appendChild(historyBtn);

                    detailsContent.appendChild(rowDiv);
                });
            });
        }

        detailsModal.style.display = 'block';
    } catch (error) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–∏–∫–∞–∂—É–≤–∞—ö–µ –Ω–∞ –¥–µ—Ç–∞–ª–∏:", error);
        alert("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–∏–∫–∞–∂—É–≤–∞—ö–µ –Ω–∞ –¥–µ—Ç–∞–ª–∏!");
    }
}




// –ó–∞—Ç–≤–æ—Ä–∏ –≥–æ –ø–æ–ø-–∞–ø –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç
function closeDetailsModal() {
    const detailsModal = document.getElementById('detailsModal');
    detailsModal.style.display = 'none'; // –°–∫—Ä–∏—ò –≥–æ –ø–æ–ø-–∞–ø –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç
}



        // Save the details as a PDF file
        function saveToPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    const detailsContent = document.getElementById('detailsContent');

    let y = 20; // –ü–æ—á–µ—Ç–Ω–∞ Y –ø–æ–∑–∏—Ü–∏—ò–∞

    // –ü–æ–º–∏–Ω—É–≤–∞—ö–µ –Ω–∏–∑ —Å–∏—Ç–µ –ø–æ–¥–∞—Ç–æ—Ü–∏ –∏ –¥–æ–¥–∞–≤–∞—ö–µ –Ω–∞ PDF
    const content = detailsContent.querySelectorAll('div');
    content.forEach((div) => {
        const label = div.querySelector('label').textContent;
        const value = div.querySelector('input').value; // –î–æ–±–∏–≤–∞—ö–µ –Ω–∞ –≤—Ä–µ–¥–Ω–æ—Å—Ç–∞ –æ–¥ input

        pdf.text(`${label} ${value}`, 10, y);
        y += 10; // –ü–æ–∑–∏—Ü–∏—ò–∞ –∑–∞ —Å–ª–µ–¥–Ω–∏–æ—Ç —Ä–µ–¥

        // –ê–∫–æ –¥–æ—Å—Ç–∏–≥–Ω–µ–º–µ –¥–æ –¥–Ω–æ—Ç–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∞—Ç–∞, –¥–æ–¥–∞—ò –Ω–æ–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        if (y > 270) {
            pdf.addPage();
            y = 20; // –†–µ—Å–µ—Ç–∏—Ä–∞—ò —ò–∞ Y –ø–æ–∑–∏—Ü–∏—ò–∞—Ç–∞
        }
    });

    // –ü—Ä–µ–∑–µ–º–∏ PDF
    const pdfBlob = pdf.output('blob');
    const pdfUrl = URL.createObjectURL(pdfBlob);
    window.open(pdfUrl, '_blank');
}


let loggedInUser = null; // –ß—É–≤–∞—ö–µ –Ω–∞ –Ω–∞—ò–∞–≤–µ–Ω–∏–æ—Ç –∫–æ—Ä–∏—Å–Ω–∏–∫

// –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Å–∏—ò–∞—Ç–∞ –ø—Ä–∏ –ª–æ–∞–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞
function checkLogin() {
    const user = localStorage.getItem("loggedInUser");
    if (user) {
        console.log("‚úÖ –ö–æ—Ä–∏—Å–Ω–∏–∫–æ—Ç –µ –Ω–∞—ò–∞–≤–µ–Ω:", user);
        document.getElementById("loginModal").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
        document.getElementById("logoutBtn").style.display = "block"; // –ü—Ä–∏–∫–∞–∂–∏ –≥–æ –∫–æ–ø—á–µ—Ç–æ –∑–∞ –æ–¥—ò–∞–≤–∞
        loggedInUser = user;
    } else {
        console.log("üîí –ö–æ—Ä–∏—Å–Ω–∏–∫–æ—Ç –Ω–µ –µ –Ω–∞—ò–∞–≤–µ–Ω, –ø—Ä–∏–∫–∞–∂–∏ –ø–æ–ø-–∞–ø –∑–∞ –Ω–∞—ò–∞–≤–∞.");
        document.getElementById("loginModal").style.display = "flex";
        document.getElementById("mainContent").style.display = "none";
        document.getElementById("logoutBtn").style.display = "none"; // –°–∫—Ä–∏—ò –≥–æ –∫–æ–ø—á–µ—Ç–æ –∑–∞ –æ–¥—ò–∞–≤–∞
    }
}


window.onload = checkLogin;  // –ü–æ–≤–∏–∫–∞—ò —ò–∞ —Ñ—É–Ω–∫—Ü–∏—ò–∞—Ç–∞ –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Å–∏—ò–∞ –∫–æ–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ —Å–µ –ª–æ–∞–¥–∏—Ä–∞

async function confirmLogin() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    if (!email || !password) {
        document.getElementById("loginError").style.display = "block";
        return;
    }

    try {
        const response = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (data.success) {
            console.log("‚úÖ –£—Å–ø–µ—à–Ω–∞ –Ω–∞—ò–∞–≤–∞:", email);
            loggedInUser = email;
            localStorage.setItem("loggedInUser", email); // –ß—É–≤–∞—ò —ò–∞ —Å–µ—Å–∏—ò–∞—Ç–∞
            document.getElementById("loginModal").style.display = "none"; // –°–∫—Ä–∏—ò –≥–æ –ø–æ–ø-–∞–ø–æ—Ç
            document.getElementById("mainContent").style.display = "block"; // –ü–æ–∫–∞–∂–∏ —ò–∞ —Å–æ–¥—Ä–∂–∏–Ω–∞—Ç–∞
        } else {
            console.log("‚ùå –ù–µ—É—Å–ø–µ—à–Ω–∞ –Ω–∞—ò–∞–≤–∞:", data.message);
            document.getElementById("loginError").style.display = "block";
        }
    } catch (error) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –Ω–∞—ò–∞–≤—É–≤–∞—ö–µ:", error);
        document.getElementById("loginError").textContent = "‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –Ω–∞—ò–∞–≤—É–≤–∞—ö–µ!";
        document.getElementById("loginError").style.display = "block";
    }
}

// –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ
// –ê–∂—É—Ä–∏—Ä–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ


    
async function showHistory(fileName, rowIndex, columnName) {
    try {
        const response = await fetch(`/history?fileName=${encodeURIComponent(fileName)}&rowIndex=${rowIndex}&columnName=${encodeURIComponent(columnName)}`);
        const historyData = await response.json();

        let historyContent = "<h3>–ò—Å—Ç–æ—Ä–∏—ò–∞ –Ω–∞ –∏–∑–º–µ–Ω–∏</h3>";
        if (historyData.length === 0) {
            historyContent += "<p>–ù–µ–º–∞ –ø—Ä–µ—Ç—Ö–æ–¥–Ω–∏ –∏–∑–º–µ–Ω–∏.</p>";
        } else {
            historyData.forEach(change => {
                historyContent += `<p><strong>${change.modifiedBy}</strong> —ò–∞ —Å–º–µ–Ω–∏ –≤—Ä–µ–¥–Ω–æ—Å—Ç–∞ –æ–¥ "${change.oldValue}" –≤–æ "${change.newValue}" –Ω–∞ ${change.timestamp}</p>`;
            });
        }

        document.getElementById('historyModalContent').innerHTML = historyContent;
        document.getElementById('historyModal').style.display = 'block';
    } catch (error) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –¥–æ–±–∏–≤–∞—ö–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—ò–∞—Ç–∞:", error);
        alert("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –¥–æ–±–∏–≤–∞—ö–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—ò–∞—Ç–∞!");
    }
}


        document.getElementById('historyModalContent').innerHTML



// –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –∑–∞—á—É–≤—É–≤–∞—ö–µ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ
async function saveChanges(event, rowIndex) {
    event.preventDefault();
    const form = event.target.form;
    const newData = {};

    Array.from(form.elements).forEach(input => {
        if (input.value !== "") {
            newData[input.dataset.column] = input.value;
        }
    });

    try {
        const response = await fetch('/edit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ rowIndex, newData })
        });

        const result = await response.json();
        alert(result.message);

        if (result.success) {
            // –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏–∫–∞–∂–∏ –≥–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –ø–æ –ø—Ä–æ–º–µ–Ω–∞—Ç–∞
            searchData();
        }
    } catch (error) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ:", error);
        alert("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—á—É–≤—É–≤–∞—ö–µ –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ!");
    }
}

// –û—Ç–∫–∞–∂–∏ –µ–¥–∏—Ç–∏—Ä–∞—ö–µ
function cancelEditing(event) {
    const form = event.target.form;
    document.body.removeChild(form);
}


function printTable(container) {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    pdf.setFontSize(12);
    let y = 20;  // Y position for the content to be printed
    
    const rows = container.querySelectorAll('.record-container div.record'); // Select each record
    
    rows.forEach(row => {
        let x = 10; // X position for the text
        
        const columns = row.querySelectorAll('div'); // Select each column in the row
        columns.forEach((column, index) => {
            const columnName = column.querySelector('span');
            const inputValue = column.querySelector('input');

            if (columnName && inputValue) {
                // Write the column name and its value in the PDF
                pdf.text(`${columnName.textContent}: ${inputValue.value}`, x, y);
                y += 10; // Increase Y for the next line
                
                // If we're too far down the page, create a new page
                if (y > 270) {
                    pdf.addPage();
                    y = 20; // Reset the Y position
                }
            }
        });
    });

    // Open the PDF in a new window
    const pdfBlob = pdf.output('blob');
    const pdfUrl = URL.createObjectURL(pdfBlob);
    window.open(pdfUrl, '_blank');
}

function logoutUser() {
    localStorage.removeItem("loggedInUser"); // –ò–∑–±—Ä–∏—à–∏ —ò–∞ —Å–µ—Å–∏—ò–∞—Ç–∞
    loggedInUser = null;
    document.getElementById("mainContent").style.display = "none"; // –°–∫—Ä–∏—ò —ò–∞ —Å–æ–¥—Ä–∂–∏–Ω–∞—Ç–∞
    document.getElementById("loginModal").style.display = "flex"; // –ü—Ä–∏–∫–∞–∂–∏ —ò–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞ –Ω–∞—ò–∞–≤–∞
}

// –û—Ç–≤–æ—Ä–∞—ö–µ –Ω–∞ –ø–æ–ø-–∞–ø –∫–æ–≥–∞ —ú–µ —Å–µ –∫–ª–∏–∫–Ω–µ –Ω–∞ –ª–æ–≥–æ—Ç–æ
document.getElementById("logo").addEventListener("click", function() {
    document.getElementById("adminModal").style.display = "block";
});

// –ó–∞—Ç–≤–æ—Ä–∞—ö–µ –Ω–∞ –ø–æ–ø-–∞–ø
function closeAdminModal() {
    document.getElementById("adminModal").style.display = "none";
}

// –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—ò–∞ –Ω–∞ –ª–æ–∑–∏–Ω–∫–∞
function verifyAdminPassword() {
    const password = document.getElementById("adminPassword").value;
    if (password === "AlkaloidAL01") {
        document.getElementById("adminModal").style.display = "none";
        document.getElementById("logsContainer").style.display = "block";
        document.getElementById("exportLogsBtn").style.display = "block"; // –ü—Ä–∏–∫–∞–∂–∏ –∫–æ–ø—á–µ –∑–∞ –∏–∑–≤–æ–∑
        document.getElementById("dateFilterContainer").style.display = "block"; // –ü—Ä–∏–∫–∞–∂–∏ —Ñ–∏–ª—Ç–µ—Ä –∑–∞ –¥–∞—Ç—É–º
        fetchLogs(); // –í—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ –ª–æ–≥–æ–≤–∏—Ç–µ
    } else {
        document.getElementById("adminError").style.display = "block";
    }
}



// –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –≤—á–∏—Ç—É–≤–∞—ö–µ –ª–æ–≥–æ–≤–∏ –≤–æ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ
async function fetchLogs() {
    try {
        const response = await fetch('/logs');
        const logs = await response.json();

        const selectedDate = document.getElementById("logDateFilter").value;
        const logsTableBody = document.getElementById("logsTable").querySelector("tbody");
        logsTableBody.innerHTML = "";

        logs.forEach(log => {
            const logDate = log.timestamp.split("T")[0]; // –ò–∑–≤–ª–µ–∫—É–≤–∞—ö–µ –Ω–∞ YYYY-MM-DD —Ñ–æ—Ä–º–∞—Ç

            if (!selectedDate || logDate === selectedDate) { // –§–∏–ª—Ç—Ä–∏—Ä–∞—ö–µ —Å–ø–æ—Ä–µ–¥ –∏–∑–±—Ä–∞–Ω–∏–æ—Ç –¥–∞—Ç—É–º
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${log.timestamp}</td>
                    <td>${log.email}</td>
                    <td>${log.action}</td>
                    <td>${log.details}</td>
                `;
                logsTableBody.appendChild(row);
            }
        });
    } catch (error) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ –ª–æ–≥–æ–≤–∏—Ç–µ:", error);
    }
}


function filterLogsByDate() {
    fetchLogs(); // –û—Å–≤–µ–∂—É–≤–∞—ö–µ –Ω–∞ —Ç–∞–±–µ–ª–∞—Ç–∞ –ø—Ä–∏ –ø—Ä–æ–º–µ–Ω–∞ –Ω–∞ –¥–∞—Ç—É–º
}


//setInterval(fetchLogs, 5000);


function exitAdminPanel() {
    document.getElementById("logsContainer").style.display = "none"; // –°–∫—Ä–∏—ò –≥–æ Admin –ø–∞–Ω–µ–ª–æ—Ç
    document.getElementById("mainContent").style.display = "block"; // –ü–æ–∫–∞–∂–∏ —ò–∞ –≥–ª–∞–≤–Ω–∞—Ç–∞ —Å–æ–¥—Ä–∂–∏–Ω–∞
    document.getElementById("exportLogsBtn").style.display = "none"; // –°–∫—Ä–∏—ò –∫–æ–ø—á–µ –∑–∞ –∏–∑–≤–æ–∑
    document.getElementById("dateFilterContainer").style.display = "none"; // –°–∫—Ä–∏—ò —Ñ–∏–ª—Ç–µ—Ä –∑–∞ –¥–∞—Ç—É–º
}



function exportToExcel() {
    let table = document.getElementById("logsTable");
    let rows = table.rows;
    let csvContent = "\uFEFF"; // –î–æ–¥–∞–≤–∞—ö–µ BOM –∑–∞ –¥–∞ —Å–µ –ø—Ä–∏–∫–∞–∂–µ –ø—Ä–∞–≤–∏–ª–Ω–æ UTF-8

    for (let i = 0; i < rows.length; i++) {
        let rowData = [];
        let cols = rows[i].cells;
        
        for (let j = 0; j < cols.length; j++) {
            rowData.push('"' + cols[j].innerText + '"'); // –û—Å–∏–≥—É—Ä—É–≤–∞—ö–µ –¥–µ–∫–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ —Å–µ –≤–æ –Ω–∞–≤–æ–¥–Ω–∏—Ü–∏
        }
        
        csvContent += rowData.join(",") + "\n";
    }

    let encodedUri = "data:text/csv;charset=utf-8," + encodeURIComponent(csvContent);
    let link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "activity_logs.csv");
    document.body.appendChild(link);
    link.click();
}


function sortTable() {
    let table = document.getElementById("logsTable");
    let rows = Array.from(table.rows).slice(1); 
    let sortedRows = rows.sort((rowA, rowB) => {
        let dateA = new Date(rowA.cells[0].innerText);
        let dateB = new Date(rowB.cells[0].innerText);
        return dateB - dateA; 
    });

    let tbody = table.querySelector("tbody");
    tbody.innerHTML = ""; 
    sortedRows.forEach(row => tbody.appendChild(row)); 
}

document.addEventListener("DOMContentLoaded", function () {
    const typeSearch = document.getElementById("typeSearch");
    if (typeSearch) {
        typeSearch.addEventListener("input", suggestFiles);
    } else {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞: 'typeSearch' –Ω–µ –ø–æ—Å—Ç–æ–∏ –≤–æ DOM!");
    }
});



document.addEventListener("DOMContentLoaded", function () {
    // –î–æ–¥–∞–≤–∞—ö–µ –Ω–∞ event listener –∑–∞ –Ω–∞—ò–∞–≤–∞ —Å–æ Enter
    document.getElementById("loginModal").addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            event.preventDefault(); 
            confirmLogin(); 
        }
    });

    // –î–æ–¥–∞–≤–∞—ö–µ –Ω–∞ event listener –∑–∞ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ —Å–æ Enter
    document.getElementById("searchQuery").addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            event.preventDefault(); 
            searchData(); 
        }
    });
});


const historyBtn = document.createElement('button');
historyBtn.textContent = '–ò—Å—Ç–æ—Ä–∏—ò–∞';
historyBtn.className = 'button history-btn';
historyBtn.style.marginLeft = '10px';
historyBtn.onclick = () => showDetails(report); // –ü–æ–≤–∏–∫–∞—ò showDetails –∑–∞ –¥–∞ –ø—Ä–∏–∫–∞–∂–µ—à –ø–æ–¥–∞—Ç–æ—Ü–∏ –≤–æ –ø–æ–ø-–∞–ø –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç

async function openFilePopup() {
    try {
        const response = await fetch('/getFilesAndFolders');

        if (!response.ok) {
            throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();
        const fileListDiv = document.getElementById('fileList');
        fileListDiv.innerHTML = ''; // –ò—Å—á–∏—Å—Ç–∏ –≥–∏ –ø—Ä–µ—Ç—Ö–æ–¥–Ω–∏—Ç–µ –ø–æ–¥–∞—Ç–æ—Ü–∏

        // üìå –ü—Ä–∏–∫–∞–∂–∏ –≥–∏ –ø–æ–¥—Ñ–æ–ª–¥–µ—Ä–∏—Ç–µ
        if (data.folders.length > 0) {
            const folderHeader = document.createElement('h4');
            folderHeader.textContent = "üìÇ –ü–æ–¥—Ñ–æ–ª–¥–µ—Ä–∏:";
            fileListDiv.appendChild(folderHeader);

            data.folders.forEach(folder => {
                const folderItem = document.createElement('div');
                folderItem.textContent = `üìÅ ${folder}`;
                folderItem.style.fontWeight = "bold";
                fileListDiv.appendChild(folderItem);
            });
        }

        // üìå –ü—Ä–∏–∫–∞–∂–∏ –≥–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ç–µ —Å–æ —á–µ–∫–±–æ–∫—Å–æ–≤–∏
        if (data.files.length > 0) {
            const fileHeader = document.createElement('h4');
            fileHeader.textContent = "üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∏:";
            fileListDiv.appendChild(fileHeader);

            data.files.forEach(file => {
                const fileItem = document.createElement('div');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = file;
                checkbox.className = 'file-checkbox';

                const label = document.createElement('label');
                label.textContent = file;
                label.style.marginLeft = '5px';

                fileItem.appendChild(checkbox);
                fileItem.appendChild(label);
                fileListDiv.appendChild(fileItem);
            });
        }

        // üìå –ü—Ä–∏–∫–∞–∂–∏ –≥–æ –ø–æ–ø-–∞–ø –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç
        document.getElementById('filePopup').style.display = 'block';
    } catch (error) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ –ª–∏—Å—Ç–∞—Ç–∞ –Ω–∞ —Ñ–∞—ò–ª–æ–≤–∏:", error);
        alert("‚ùå –ù–µ –º–æ–∂–µ –¥–∞ —Å–µ –≤—á–∏—Ç–∞ –ª–∏—Å—Ç–∞—Ç–∞ –Ω–∞ —Ñ–∞—ò–ª–æ–≤–∏. –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–∞–ª–∏ —Å–µ—Ä–≤–µ—Ä–æ—Ç –µ –∞–∫—Ç–∏–≤–µ–Ω.");
    }
}

// üìå –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –∑–∞—Ç–≤–æ—Ä–∞—ö–µ –Ω–∞ –ø–æ–ø-–∞–ø –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç
function closePopup() {
    document.getElementById('filePopup').style.display = 'none';
}


// üìå –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –∑–∞—Ç–≤–æ—Ä–∞—ö–µ –Ω–∞ –ø–æ–ø-–∞–ø –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç
function closePopup() {
    document.getElementById('filePopup').style.display = 'none';
}





async function suggestFiles() {
    const typeSearch = document.getElementById('typeSearch');
    if (!typeSearch) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞: 'typeSearch' –Ω–µ –ø–æ—Å—Ç–æ–∏!");
        return;
    }

    const input = typeSearch.value.toLowerCase();
    const suggestionBox = document.getElementById('suggestionList');

    if (input.length < 2) {
        suggestionBox.style.display = 'none';
        return;
    }

    try {
        const response = await fetch('/getFiles');
        if (!response.ok) {
            throw new Error(`Server error: ${response.status}`);
        }

        const files = await response.json();
        const filteredFiles = files.filter(file => file.toLowerCase().includes(input));

        suggestionBox.innerHTML = '';
        if (filteredFiles.length === 0) {
            suggestionBox.style.display = 'none';
            return;
        }

        filteredFiles.forEach(file => {
            const suggestion = document.createElement('div');
            suggestion.textContent = file;
            suggestion.onclick = () => addSelectedFile(file);
            suggestionBox.appendChild(suggestion);
        });

        suggestionBox.style.display = 'block';
    } catch (error) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—á–∏—Ç—É–≤–∞—ö–µ –Ω–∞ —Å—É–≥–µ—Å—Ç–∏–∏:", error);
    }
}


// üìå –î–æ–¥–∞–≤–∞—ö–µ –Ω–∞ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç –≤–æ –ª–∏—Å—Ç–∞—Ç–∞
function addSelectedFile(fileName) {
    if (!selectedFiles.includes(fileName)) {
        selectedFiles.push(fileName);
        updateSelectedFilesDisplay();
    }
    const typeSearch = document.getElementById('typeSearch');
    if (typeSearch) typeSearch.value = ''; 
    document.getElementById('suggestionList').style.display = 'none';
}


// üìå –ü—Ä–∏–∫–∞–∂—É–≤–∞—ö–µ –Ω–∞ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏
function updateSelectedFilesDisplay() {
    const selectedFilesDiv = document.getElementById('selectedFiles');
    selectedFilesDiv.innerHTML = '';

    console.log("üìÇ –°–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏:", selectedFiles); // –î–µ–±–∞–≥–∏—Ä–∞—ò —ò–∞ –≤—Ä–µ–¥–Ω–æ—Å—Ç–∞

    selectedFiles.forEach(fileName => {
        const fileDiv = document.createElement('div');
        fileDiv.className = 'selected-file';

        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'X';
        removeBtn.onclick = () => removeSelectedFile(fileName);

        const fileLabel = document.createElement('span');
        fileLabel.textContent = fileName;

        fileDiv.appendChild(removeBtn);
        fileDiv.appendChild(fileLabel);
        selectedFilesDiv.appendChild(fileDiv);
    });
}


// üìå –û—Ç—Å—Ç—Ä–∞–Ω—É–≤–∞—ö–µ –Ω–∞ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç
function removeSelectedFile(fileName) {
    selectedFiles = selectedFiles.filter(file => file !== fileName);
    updateSelectedFilesDisplay();
}

// üìå –ö–æ—Ä–∏—Å—Ç–∏ –≥–∏ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –ø—Ä–∏ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ
async function startSearch() {
    if (!loggedInUser) {
        alert("–ú–æ—Ä–∞ –¥–∞ —Å–µ –Ω–∞—ò–∞–≤–∏—Ç–µ –∑–∞ –¥–∞ –ø—Ä–µ–±–∞—Ä—É–≤–∞—Ç–µ!");
        return;
    }

    const query = document.getElementById('searchQuery').value;
    const resultsDiv = document.getElementById('results');

    if (!Array.isArray(selectedFiles) || selectedFiles.length === 0) {
        console.warn("‚ö† –ù–µ–º–∞ —Å–µ–ª–µ–∫—Ç–∏—Ä–∞–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏, –ø—Ä–µ–±–∞—Ä—É–≤–∞–º –≤–æ —Å–∏—Ç–µ!");
    }

    resultsDiv.innerHTML = '<p>–ü—Ä–µ–±–∞—Ä—É–≤–∞–º...</p>'; // –ü—Ä–∏–∫–∞–∂–∏ –ø–æ—Ä–∞–∫–∞ –∑–∞ —á–µ–∫–∞—ö–µ

    try {
        const response = await fetch('/search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query, email: loggedInUser, selectedFiles })
        });

        const data = await response.json();
        resultsDiv.innerHTML = ''; // –ò—Å—á–∏—Å—Ç–∏ –≥–∏ –ø—Ä–µ—Ç—Ö–æ–¥–Ω–∏—Ç–µ –ø–æ–¥–∞—Ç–æ—Ü–∏

        if (data.length === 0) {
            resultsDiv.innerHTML = '<p>–ù–µ —Å–µ –ø—Ä–æ–Ω–∞—ò–¥–µ–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.</p>';
        } else {
            let tableHtml = `<table>
                                <tr>
                                    <th>–§–∞—ò–ª</th>
                                    <th>–î–µ—Ç–∞–ª–∏</th>
                                </tr>`;

            data.forEach(report => {
                tableHtml += `<tr>
                                <td>${report.fileName}</td>
                                <td><button class="button edit-btn" onclick="showDetails('${report.fileName}')">–î–µ—Ç–∞–ª–∏</button></td>
                              </tr>`;
            });

            tableHtml += `</table>`;
            resultsDiv.innerHTML = tableHtml;
        }
    } catch (error) {
        console.error("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ:", error);
        alert("‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–µ–±–∞—Ä—É–≤–∞—ö–µ!");
    }
}



</script>

</body>
</html>